package generator;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.time.LocalDateTime;
import java.util.Random;

/**
 * Legacy Data Generator for E-Commerce Simulation
 * Shopee / Lazada-like system
 */
public class LegacyDataGenerator {

    private static final Random rand = new Random();

    private static final int USER_COUNT = 10000;
    private static final int SHOP_COUNT = 100;
    private static final int PRODUCT_COUNT = 500;
    private static final int ORDER_COUNT = 15000;

    public static void main(String[] args) {
        try {
            createDataFolder();

            generateUsers();
            generateShops();
            generateProducts();
            generateVariants();
            generateVouchers();
            generateOrders();

            System.out.println("ðŸŽ‰ Legacy CSV dataset generated successfully!");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    // ================== UTILITY ==================
    private static void createDataFolder() {
        File dir = new File("data");
        if (!dir.exists()) {
            dir.mkdir();
        }
    }

    // ================== USERS ==================
    private static void generateUsers() throws IOException {
        FileWriter fw = new FileWriter("data/users.csv");
        fw.write("user_id,name,email,user_type,balance\n");

        for (int i = 1; i <= USER_COUNT; i++) {
            fw.write(String.format(
                    "U%05d,User %d,user%d@gmail.com,%s,%d\n",
                    i,
                    i,
                    i,
                    rand.nextBoolean() ? "normal" : "vip",
                    rand.nextInt(5_000_000) + 100_000
            ));
        }
        fw.close();
    }

    // ================== SHOPS ==================
    private static void generateShops() throws IOException {
        FileWriter fw = new FileWriter("data/shops.csv");
        fw.write("shop_id,shop_name,rating,status\n");

        for (int i = 1; i <= SHOP_COUNT; i++) {
            fw.write(String.format(
                    "S%03d,Shop %d,%.1f,active\n",
                    i,
                    i,
                    3.5 + rand.nextDouble() * 1.5
            ));
        }
        fw.close();
    }

    // ================== PRODUCTS ==================
    private static void generateProducts() throws IOException {
        FileWriter fw = new FileWriter("data/products.csv");
        fw.write("product_id,shop_id,name,base_price\n");

        for (int i = 1; i <= PRODUCT_COUNT; i++) {
            fw.write(String.format(
                    "P%04d,S%03d,Product %d,%d\n",
                    i,
                    rand.nextInt(SHOP_COUNT) + 1,
                    i,
                    rand.nextInt(500_000) + 100_000
            ));
        }
        fw.close();
    }

    // ================== PRODUCT VARIANTS ==================
    private static void generateVariants() throws IOException {
        String[] sizes = {"S", "M", "L", "XL"};
        String[] colors = {"Black", "White", "Red", "Blue"};

        FileWriter fw = new FileWriter("data/product_variants.csv");
        fw.write("variant_id,product_id,size,color,price,stock\n");

        int variantId = 1;

        for (int p = 1; p <= PRODUCT_COUNT; p++) {
            for (String size : sizes) {
                for (String color : colors) {
                    fw.write(String.format(
                            "V%05d,P%04d,%s,%s,%d,%d\n",
                            variantId++,
                            p,
                            size,
                            color,
                            rand.nextInt(500_000) + 100_000,
                            rand.nextInt(100)
                    ));
                }
            }
        }
        fw.close();
    }

    // ================== VOUCHERS ==================
    private static void generateVouchers() throws IOException {
        FileWriter fw = new FileWriter("data/vouchers.csv");
        fw.write("voucher_id,type,value,scope,min_order,max_discount,quantity\n");

        fw.write("VC001,PERCENT,10,PLATFORM,200000,50000,1000\n");
        fw.write("VC002,FIXED,50000,SHOP,300000,50000,500\n");
        fw.write("VC003,PERCENT,20,PRODUCT,100000,70000,300\n");

        fw.close();
    }

    // ================== ORDERS & ORDER ITEMS ==================
    private static void generateOrders() throws IOException {
        FileWriter orderWriter = new FileWriter("data/orders.csv");
        FileWriter itemWriter = new FileWriter("data/order_items.csv");

        orderWriter.write("order_id,user_id,total_price,status,created_at\n");
        itemWriter.write("order_item_id,order_id,variant_id,price,quantity\n");

        for (int i = 1; i <= ORDER_COUNT; i++) {
            String orderId = String.format("O%06d", i);

            orderWriter.write(String.format(
                    "%s,U%05d,%d,%s,%s\n",
                    orderId,
                    rand.nextInt(USER_COUNT) + 1,
                    rand.nextInt(3_000_000) + 100_000,
                    randomStatus(),
                    LocalDateTime.now().minusMinutes(rand.nextInt(200_000))
            ));

            int itemCount = rand.nextInt(3) + 1;
            for (int j = 1; j <= itemCount; j++) {
                itemWriter.write(String.format(
                        "OI%06d_%d,%s,V%05d,%d,%d\n",
                        i,
                        j,
                        orderId,
                        rand.nextInt(PRODUCT_COUNT * 16) + 1,
                        rand.nextInt(500_000) + 100_000,
                        rand.nextInt(3) + 1
                ));
            }
        }

        orderWriter.close();
        itemWriter.close();
    }

    private static String randomStatus() {
        String[] statuses = {"PAID", "PENDING", "CANCEL"};
        return statuses[rand.nextInt(statuses.length)];
    }
}
